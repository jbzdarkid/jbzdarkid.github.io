<html>
  <head>
    <title>Talos Paint Spawns</title>
    <meta charset="utf-8">
    <meta name="description" content="How to predict paint spawns in The Talos Principle">
    <meta name="tags" content="talos, principle, paint, spawn, rng">
    <script type="text/javascript" src="autosize.js"></script>
  </head>
  <body>
    Credit to sjcTheos for his research (code finding, spreadsheet work, image to game index matching) and for discovering this trick.
    Here are the 5 sets of spawns that can appear. Note that these sets <b>only</b> apply to maps with 4 potential spawn points, not to all maps!<br>
    As a general rule, to completely identify which spawn set you have, you will need to visit one even and one odd numbered map (Star worlds are numbered 8).<br>
    <table width="100%"><tr>
      <td></td>
      <td style="text-align: center; font-size: 1.5em">0</a></td>
      <td style="text-align: center; font-size: 1.5em">1</a></td>
      <td style="text-align: center; font-size: 1.5em">2</a></td>
      <td style="text-align: center; font-size: 1.5em">3</a></td>
      <td style="text-align: center; font-size: 1.5em">4</a></td>
    </tr><tr>
      <td style="text-align: center; font-size: 1.5em">A5</td>
      <td><a href="http://i.imgur.com/CNeDKJQ.png" title="Back and right from spawn"><img src="http://i.imgur.com/z68NQYh.jpg"></img></a></td>
      <td><a href="http://i.imgur.com/46yURnK.png" title="Behind the left-hand broken pillar"><img src="http://i.imgur.com/MBHpRaS.jpg"></img></a></td>
      <td><a href="http://i.imgur.com/dwyykj7.png" title="Straight left from spawn"><img src="http://i.imgur.com/DHzOriy.jpg"></img></a></td>
      <td><a href="http://i.imgur.com/46yURnK.png" title="Behind the left-hand broken pillar"><img src="http://i.imgur.com/MBHpRaS.jpg"></img></a></td>
      <td><a href="http://i.imgur.com/dwyykj7.png" title="Straight left from spawn"><img src="http://i.imgur.com/DHzOriy.jpg"></img></a></td>
    </tr><tr>
      <td style="text-align: center; font-size: 1.5em">A6</td>
      <td><a href="http://i.imgur.com/WTPKVJ6.png" title="Arch paint"><img src="http://i.imgur.com/PUJYjXK.jpg"></img></a></td>
      <td><a href="http://i.imgur.com/JVCPx1d.png" title="Tree paint"><img src="http://i.imgur.com/3aoUKN6.jpg"></img></a></td>
      <td><a href="http://i.imgur.com/WTPKVJ6.png title="Arch paint"><img src="http://i.imgur.com/PUJYjXK.jpg"></img></a></td>
      <td><a href="http://i.imgur.com/VUjYMbS.png title="Deception paint"><img src="http://i.imgur.com/XcYbbzG.jpg"></img></a></td>
      <td><a href="http://i.imgur.com/XViFIrZ.png title="Back paint"><img src="http://i.imgur.com/2MvzBYB.jpg"></img></a></td>
    </tr><tr>
      <td style="text-align: center; font-size: 1.5em">A7</td>
      <td><a href="http://i.imgur.com/ShwBToF.png" title="Straight ahead from spawn"><img src="http://i.imgur.com/61Qe6ID.jpg"></img></a></td>
      <td><a href="http://i.imgur.com/ynR5o0P.png" title="To the left from spawn"><img src="http://i.imgur.com/mGS74md.jpg"></img></a></td>
      <td><a href="http://i.imgur.com/ynR5o0P.png" title="To the left from spawn"><img src="http://i.imgur.com/mGS74md.jpg"></img></a></td>
      <td><a href="http://i.imgur.com/ynR5o0P.png" title="To the left from spawn"><img src="http://i.imgur.com/mGS74md.jpg"></img></a></td>
      <td><a href="http://i.imgur.com/ynR5o0P.png" title="To the left from spawn"><img src="http://i.imgur.com/mGS74md.jpg"></img></a></td>
    </tr><tr>
      <td style="text-align: center; font-size: 1.5em">B4</td>
      <td><a href="http://i.imgur.com/cIVNt1r.png" title="Second-best spawn"><img src="http://i.imgur.com/1ORXopQ.jpg"></img></a></td>
      <td><a href="http://i.imgur.com/8dRUrPx.png" title="Best spawn"><img src="http://i.imgur.com/bm4HFTu.jpg"></img></a></td>
      <td><a href="http://i.imgur.com/o8QCvYF.png" title="Second-worst spawn"><img src="http://i.imgur.com/ub14WQX.jpg"></img></a></td>
      <td><a href="http://i.imgur.com/P25xzaW.png" title="Worst spawn"><img src="http://i.imgur.com/tpMQ0zd.jpg"></img></a></td>
      <td><a href="http://i.imgur.com/cIVNt1r.png" title="Second-best spawn"><img src="http://i.imgur.com/1ORXopQ.jpg"></img></a></td>
    </tr><tr>
      <td style="text-align: center; font-size: 1.5em">B5</td>
      <td><a href="http://i.imgur.com/RnHcm81.png"><img src="http://i.imgur.com/zhuNmyj.jpg"></img></a></td>
      <td><a href="http://i.imgur.com/EH5G9ya.png"><img src="http://i.imgur.com/4H1RDOv.jpg"></img></a></td>
      <td><a href="http://i.imgur.com/6JGACSK.png"><img src="http://i.imgur.com/wc6jRfl.jpg"></img></a></td>
      <td><a href="http://i.imgur.com/EH5G9ya.png"><img src="http://i.imgur.com/4H1RDOv.jpg"></img></a></td>
      <td><a href="http://i.imgur.com/6JGACSK.png"><img src="http://i.imgur.com/wc6jRfl.jpg"></img></a></td>
    </tr><tr>
      <td style="text-align: center; font-size: 1.5em">B6</td>
      <td><a href="http://i.imgur.com/n4TSe1c.png"><img src="http://i.imgur.com/t9P8Aux.jpg"></img></a></td>
      <td><a href="http://i.imgur.com/9yUhLCh.png"><img src="http://i.imgur.com/WvCcbE5.jpg"></img></a></td>
      <td><a href="http://i.imgur.com/n4TSe1c.png"><img src="http://i.imgur.com/t9P8Aux.jpg"></img></a></td>
      <td><a href="http://i.imgur.com/XvTsae8.png"><img src="http://i.imgur.com/IW7dOqa.jpg"></img></a></td>
      <td><a href="http://i.imgur.com/5Z2QrTT.png"><img src="http://i.imgur.com/3bCZ9UA.jpg"></img></a></td>
    </tr><tr>
      <td style="text-align: center; font-size: 1.5em">B7</td>
      <td><a href="http://i.imgur.com/jwEkeQW.png"><img src="http://i.imgur.com/7LAMIgZ.jpg"></img></a></td>
      <td><a href="http://i.imgur.com/7Mehrh7.png"><img src="http://i.imgur.com/ubG26Bf.jpg"></img></a></td>
      <td><a href="http://i.imgur.com/7Mehrh7.png"><img src="http://i.imgur.com/ubG26Bf.jpg"></img></a></td>
      <td><a href="http://i.imgur.com/7Mehrh7.png"><img src="http://i.imgur.com/ubG26Bf.jpg"></img></a></td>
      <td><a href="http://i.imgur.com/7Mehrh7.png"><img src="http://i.imgur.com/ubG26Bf.jpg"></img></a></td>
    </tr><tr>
      <td style="text-align: center; font-size: 1.5em">B Star</td>
      <td><a href="http://i.imgur.com/CzrREHx.png"><img src="http://i.imgur.com/6Wr8eXa.jpg"></img></a></td>
      <td><a href="http://i.imgur.com/0Nc1fzx.png"><img src="http://i.imgur.com/ywWyJQD.jpg"></img></a></td>
      <td><a href="http://i.imgur.com/HIdplcP.png"><img src="http://i.imgur.com/ElfCZeB.jpg"></img></a></td>
      <td><a href="http://i.imgur.com/nYoxs7v.png"><img src="http://i.imgur.com/poJks17.jpg"></img></a></td>
      <td><a href="http://i.imgur.com/CzrREHx.png"><img src="http://i.imgur.com/6Wr8eXa.jpg"></img></a></td>
    </tr><tr>
      <td style="text-align: center; font-size: 1.5em">C1</td>
      <td><a href="http://i.imgur.com/0gA4CQE.png" title="Bridge"><img src="http://i.imgur.com/omNWGUI.jpg"></img></a></td>
      <td><a href="http://i.imgur.com/LVkQAct.png" title="Stump near spawn"><img src="http://i.imgur.com/QO9XhHL.jpg"></img></a></td>
      <td><a href="http://i.imgur.com/OuOxTe0.png" title="Stump near bridge"><img src="http://i.imgur.com/24yRgEZ.jpg"></img></a></td>
      <td><a href="http://i.imgur.com/LVkQAct.png" title="Stump near spawn"><img src="http://i.imgur.com/QO9XhHL.jpg"></img></a></td>
      <td><a href="http://i.imgur.com/OuOxTe0.png" title="Stump near bridge"><img src="http://i.imgur.com/24yRgEZ.jpg"></img></a></td>
    </tr><tr>
      <td style="text-align: center; font-size: 1.5em">C2</td>
      <td><a href="http://i.imgur.com/kVMi6Gi.png"><img src="http://i.imgur.com/XwnWKrW.jpg"></img></a></td>
      <td><a href="http://i.imgur.com/aMtKypG.png"><img src="http://i.imgur.com/BYv6U6w.jpg"></img></a></td>
      <td><a href="http://i.imgur.com/kVMi6Gi.png"><img src="http://i.imgur.com/XwnWKrW.jpg"></img></a></td>
      <td><a href="http://i.imgur.com/kZrhNoV.png"><img src="http://i.imgur.com/qmvG2uC.jpg"></img></a></td>
      <td><a href="http://i.imgur.com/LIVhdXh.png"><img src="http://i.imgur.com/I9LM9mI.jpg"></img></a></td>
    </tr><tr>
      <td style="text-align: center; font-size: 1.5em">C3</td>
      <td><a href="http://i.imgur.com/f4nrODB.png" title="Weird"><img src="http://i.imgur.com/1YAKoZc.jpg"></img></a></td>
      <td><a href="http://i.imgur.com/j7kQPcN.png" title="Normal"><img src="http://i.imgur.com/4YFBxNQ.jpg"></img></a></td>
      <td><a href="http://i.imgur.com/j7kQPcN.png" title="Normal"><img src="http://i.imgur.com/4YFBxNQ.jpg"></img></a></td>
      <td><a href="http://i.imgur.com/j7kQPcN.png" title="Normal"><img src="http://i.imgur.com/4YFBxNQ.jpg"></img></a></td>
      <td><a href="http://i.imgur.com/j7kQPcN.png" title="Normal"><img src="http://i.imgur.com/4YFBxNQ.jpg"></img></a></td>
    </tr><tr>
      <td style="text-align: center; font-size: 1.5em">C4</td> <!-- Source image for C4-0 was 5.0 mb, which gets converted to .jpg on upload. -->
      <td><a href="http://i.imgur.com/OuRtbZw.jpg" title="Oubliette"><img src="http://i.imgur.com/awYrAX3.jpg"></img></a></td>
      <td><a href="http://i.imgur.com/Pbd4MMr.png" title="Armory"><img src="http://i.imgur.com/OeuRAH6.jpg"></img></a></td>
      <td><a href="http://i.imgur.com/zmz8yeh.png" title="Between throne and oubliette"><img src="http://i.imgur.com/OVg7Heu.jpg"></img></a></td>
      <td><a href="http://i.imgur.com/rmRKYtT.png" title="Between throne and armory"><img src="http://i.imgur.com/V3gtI2a.jpg"></img></a></td>
      <td><a href="http://i.imgur.com/OuRtbZw.jpg" title="Oubliette"><img src="http://i.imgur.com/awYrAX3.jpg"></img></a></td>
    </tr><tr>
      <td style="text-align: center; font-size: 1.5em">C5</td>
      <td><a href="http://i.imgur.com/Vwbx3wa.png"><img src="http://i.imgur.com/q17ncUt.jpg"></img></a></td>
      <td><a href="http://i.imgur.com/HEdIT0f.png"><img src="http://i.imgur.com/0FKvux4.jpg"></img></a></td>
      <td><a href="http://i.imgur.com/XwAEJCR.png"><img src="http://i.imgur.com/9FiTLUN.jpg"></img></a></td>
      <td><a href="http://i.imgur.com/HEdIT0f.png"><img src="http://i.imgur.com/0FKvux4.jpg"></img></a></td>
      <td><a href="http://i.imgur.com/XwAEJCR.png"><img src="http://i.imgur.com/9FiTLUN.jpg"></img></a></td>
    </tr><tr>
      <td style="text-align: center; font-size: 1.5em">C6</td>
      <td><a href="http://i.imgur.com/ejdlxGG.png" title="Grave"><img src="http://i.imgur.com/EiYXy2g.jpg"></img></a></td>
      <td><a href="http://i.imgur.com/AG2H1bk.png" title="Corner"><img src="http://i.imgur.com/ezdELvA.jpg"></img></a></td>
      <td><a href="http://i.imgur.com/ejdlxGG.png" title="Grave"><img src="http://i.imgur.com/EiYXy2g.jpg"></img></a></td>
      <td><a href="http://i.imgur.com/f6nDK2d.png" title="Near Seven Doors"><img src="http://i.imgur.com/xfSl3gM.jpg"></img></a></td>
      <td><a href="http://i.imgur.com/NU2rnhp.png" title="Parkour"><img src="http://i.imgur.com/OugbsVI.jpg"></img></a></td>
    </tr><tr>
      <td style="text-align: center; font-size: 1.5em">C7</td>
      <td><a href="http://i.imgur.com/YsZusvo.png" title="Weird"><img src="http://i.imgur.com/LhI6lgd.jpg"></img></a></td>
      <td><a href="http://i.imgur.com/P8LqHhB.png" title="Normal"><img src="http://i.imgur.com/lapKJLf.jpg"></img></a></td>
      <td><a href="http://i.imgur.com/P8LqHhB.png" title="Normal"><img src="http://i.imgur.com/lapKJLf.jpg"></img></a></td>
      <td><a href="http://i.imgur.com/P8LqHhB.png" title="Normal"><img src="http://i.imgur.com/lapKJLf.jpg"></img></a></td>
      <td><a href="http://i.imgur.com/P8LqHhB.png" title="Normal"><img src="http://i.imgur.com/lapKJLf.jpg"></img></a></td>
    </tr><tr>
      <td style="text-align: center; font-size: 1.5em">C Star</td>
      <td><a href="http://i.imgur.com/XIsT6KB.png" title="Right broken wall"><img src="http://i.imgur.com/371VSMU.jpg"></img></a></td>
      <td><a href="http://i.imgur.com/FflHDLb.png" title="Left broken wall"><img src="http://i.imgur.com/ZOoc7CC.jpg"></img></a></td>
      <td><a href="http://i.imgur.com/HR7Xvul.png" title="Near spawn"><img src="http://i.imgur.com/rYaWCVI.jpg"></img></a></td>
      <td><a href="http://i.imgur.com/tfmkPNY.png" title="Parkour"><img src="http://i.imgur.com/4Ux1mM5.jpg"></img></a></td>
      <td><a href="http://i.imgur.com/XIsT6KB.png" title="Right broken wall"><img src="http://i.imgur.com/371VSMU.jpg"></img></a></td>
    </tr></table>
    <H1>Let's get technical</H1>
    The reason this works is because of how Paint RNG is seeded in Talos. Here's the Lua code that determines paint spawns:
    <pre>
    -- nothing to do if messages are not available for current world
    if not talPlayerMessagesAvailableForCurrentWorld(worldGlobals.worldInfo) then
      return
    end
    </pre>
    Exit program if player is done with the current world.
    <pre>
    local function RandomFomStringChars(str, multiplier)
      local len = #str
      local sum = 0
      local offset = 32
      for i = 1, len do
        sum = (string.byte(str, i) - offset)*multiplier
      end
      return sum
    end
    </pre>
    This function creates an add-in seed which is <b>supposed</b> to be based on the world name. However, this calls <code>sum =</code> not <code>sum = sum +</code>, and so it in fact only uses the last character in the world name, in this case the world number.
    <pre>
    local function ShowPaintBucketIfNecessary()

      -- paint buckets can onlys be unlocked if enough messages are unlocked
      if talGetUnlockedPlayerMessagesCount(worldGlobals.worldInfo) < 5 then
        -- paint item was not shown
        return false
      end
    </pre>
    Exit function if player doesn't have paint unlocked.
    <pre>
      -- talosProgress : CTalosProgress
      local talosProgress = nexGetTalosProgress(worldGlobals.worldInfo)
      local randomSeed = talosProgress:GetCodeValue("PaintItemSeed")
      if randomSeed == -1 then
        randomSeed = mthRoundF(mthRndF()*8909478)
        talosProgress:SetCode("PaintItemSeed", randomSeed)
      end
      local worldName = string.match(worldGlobals.worldInfo:GetWorldFileName(), "([^/]+)%.wld$")
      if randomSeed < 0 then
        randomSeed = -randomSeed
      end
      local multiplier = randomSeed % 8
      if multiplier == 0 then
        multiplier = 1
      end
    </pre>
    This generates a random integer from 0 to 8909478, then from it creates a multiplier from 1-7. Note that a multiplier of 1 will occur with probability 1/4.
    <pre>
      local randomIndex = randomSeed + RandomFomStringChars(worldName, multiplier)
      if randomIndex < 0 then
        randomIndex = -randomIndex
      end
    </pre>
    Now, the random integer from 0 to 8909478 is increased by the world name string times the multiplier. This means that the spawn set on A6 differs from A7, but not from B6.
    <pre>
      local randomPaintItemIndex = 1 + randomIndex % #worldGlobals.paintItems
      worldGlobals.paintItems[randomPaintItemIndex]:Show()
      -- paint item was shown
      return true
    end
    </pre>
    Then, we convert the random number to a paint spawn. However, if there are 4 paint spawns (<code>#worldGlobals.paintItems</code>), then problems will arise because 4 and 8 are not coprime. For example, if we're on A3, then we calculate <code>n + (n%8)*3</code>, which will be 0 or 4 mod 8. The exception is if 8 | n and the multiplier is set to 1, in which case it will be 7 mod 8. Regardless, this is not an even distribution of values 0-7, and it is this behavior that causes uneven spawns.
    <pre>
    RunAsync(function()
      -- wait for all other scripts/items to boot
      Wait(Delay(0.00001))
      -- nothing to do if there are no paint items in the world
      if worldGlobals.paintItems == nil then
        return
      end
      -- show paint bucket if necessary at start
      if ShowPaintBucketIfNecessary() then
        -- since paint item was shown, there is no need to handle message unlocking
        -- events and check if paint item should be shown again
        return
      end
      -- wait for message unlocking event until paint bucket is shown
      while true do
        Wait(CustomEvent("PlayerMessageUnlocked"))
        if ShowPaintBucketIfNecessary() then
          break
        end
      end
    end)
    </pre>
    This code just checks a couple of edge cases and only displays paint if needed.
    <p>
    So let's take a look at the arithmetic:
    <table class="spawnTable" border="1px solid black" cellspacing=0 style="text-align:center">
      <tr>
        <td>RNG % 8</td>
        <td>Multiplier</td>
        <td>World Number:<br><input type="text" id="worldNumber" value="7" style="width:50px; text-align:center"><button onclick="updateTable()">Update</button></td>
        <td>Paint index = RNG + <br>Multiplier * World Number</td>
        <td>Paint spawn =<br>Paint index % 4</td>
      </tr>
      <tr><td></td><td></td><td></td><td></td><td></td></tr>
      <tr><td></td><td></td><td></td><td></td><td></td></tr>
      <tr><td></td><td></td><td></td><td></td><td></td></tr>
      <tr><td></td><td></td><td></td><td></td><td></td></tr>
      <tr><td></td><td></td><td></td><td></td><td></td></tr>
      <tr><td></td><td></td><td></td><td></td><td></td></tr>
      <tr><td></td><td></td><td></td><td></td><td></td></tr>
      <tr><td></td><td></td><td></td><td></td><td></td></tr>
    </table>
    <script type="text/javascript">
      function updateTable() {
        table = document.getElementsByClassName('spawnTable')[0];
        worldNumber = document.getElementById('worldNumber').value;
        for (c = 0; c<8; c++) {
          table.rows[c+1].cells[0].innerHTML = c;
          table.rows[c+1].cells[1].innerHTML = (c==0?1:c);
          table.rows[c+1].cells[2].innerHTML = worldNumber;
          table.rows[c+1].cells[3].innerHTML = c+(c==0?1:c)*worldNumber;
          table.rows[c+1].cells[4].innerHTML = (c+(c==0?1:c)*worldNumber) % 4;
        }
      }
      updateTable();
    </script>
    The modulo 8 creates 8 total spawn sets, and the modulo 4 means that sets 0/4, 1/5, 2/6, 3/7 are the same.<br>
    However, when the multiplier is 0 mod 8, it is set to 1, which differentiates sets 0 and 4 and gives us our 5 sets.
  </body>
</html>
