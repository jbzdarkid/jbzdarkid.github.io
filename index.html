<html>
  <head>
    <style>
      * {
        vertical-align: middle;
        text-align: center;
      }
      body {
        font-size: 2.5em;
      }
      input {
        font-size: 1.25em;
      }
      
    </style>
    <meta name='apple-mobile-web-app-capable' content='yes'> <!-- Can be loaded as a shortcut -->
    <link id='link' rel='apple-touch-icon' href='Bookmark-icon.png'> <!-- Sets the shortcut icon -->
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <title id='title'>Shortcut Creator</title>
  </head>
  <body>
    First, type in the URL for your shortcut:
    <input style='width: 100%' type='url' id='linkInput' onchange='updateLink()'>
    <p></p>
    Then, give your shortcut a name:
    <input style='width: 100%' type='text' id='titleInput' onchange='updateTitle()'>
    <p></p>
    Next, give your shortcut a picture:<br>
    <label>
      <input type='file' id='imageInput' onchange='updateImage()' style='display:none'>
      <img id='imagePreview' style='border: 2px solid black' alt='&nbsp;Choose file&nbsp;'>
    </label>
    <p></p>
    Finally, tap <img src='Bookmark-icon.png'> and then <img src='Save_home-icon.png'> to save the shortcut.

    <script type='text/javascript'>
      if (window.navigator.standalone) { // If opened via shortcut
        window.location.href = window.location.hash.substring(1);
        window.location.href = 'about:blank';
      }

      var image = document.getElementById('imagePreview');
      var reader = new FileReader();
      var FINAL_WIDTH = 128;
      reader.addEventListener('load', function() {
        document.write(46);
        image.src = reader.result;
        document.write(48);
        var size = Math.min(image.width, image.height);
        document.write(50);
        var canvas = document.createElement('canvas');
        document.write(52);
        canvas.width = FINAL_WIDTH.toString();
        canvas.height = FINAL_WIDTH.toString();
        document.write(55);
        var ctx = canvas.getContext('2d');
        document.write(57);
        // Cropped to square and scaled down to FINAL_WIDTH * FINAL_WIDTH
        ctx.drawImage(image, (image.width - size)/2, (image.height - size)/2, size, size, 0, 0, FINAL_WIDTH, FINAL_WIDTH);
        document.write(60);
        image.src = canvas.toDataURL('image/png')
        document.write(62);
        document.getElementById('link').href = canvas.toDataURL('image/png');
      });

      function updateImage() {
        reader.readAsDataURL(document.getElementById('imageInput').files[0]);
      }
      function updateTitle() {
        document.getElementById('title').innerHTML = document.getElementById('titleInput').value;
      }
      function updateLink() {
        window.location.hash = document.getElementById('linkInput').value;
      }
    </script>
  </body>
</html>
